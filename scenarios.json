{
    "defaultScenarioId":  "http-tcp",
    "scenarios":  [
                      {
                          "id":  "http-tcp",
                          "title":  "Entrega HTTP con TCP/IP",
                          "summary":  "Handshake TCP, encapsulado IP y reordenamiento de segmentos antes de entregar una solicitud HTTP al servidor.",
                          "steps":  [
                                        {
                                            "id":  "app-request",
                                            "title":  "Capa de aplicación: preparar solicitud HTTP",
                                            "description":  "El navegador arma una solicitud GET. Todavía no se ha agregado ningún encabezado de transporte ni de red.",
                                            "activeLayer":  "Aplicación",
                                            "layers":  [
                                                           {
                                                               "name":  "Aplicación",
                                                               "protocol":  "HTTP",
                                                               "info":  "Solicitud GET /index.html",
                                                               "active":  true
                                                           },
                                                           {
                                                               "name":  "Transporte",
                                                               "protocol":  "TCP",
                                                               "info":  "Esperando crear segmento"
                                                           },
                                                           {
                                                               "name":  "Red",
                                                               "protocol":  "IP",
                                                               "info":  "Pendiente de encapsular"
                                                           },
                                                           {
                                                               "name":  "Enlace",
                                                               "protocol":  "Ethernet",
                                                               "info":  "Sin frame"
                                                           },
                                                           {
                                                               "name":  "Física",
                                                               "protocol":  "Medio",
                                                               "info":  "Sin señal"
                                                           }
                                                       ],
                                            "packet":  {
                                                           "direction":  "Cliente → Servidor",
                                                           "fields":  [
                                                                          {
                                                                              "label":  "Payload",
                                                                              "value":  "GET /index.html HTTP/1.1"
                                                                          }
                                                                      ]
                                                       },
                                            "events":  [
                                                           "La capa de aplicación genera el mensaje HTTP.",
                                                           "El mensaje se pasa como bloque de datos a la capa de transporte."
                                                       ]
                                        },
                                        {
                                            "id":  "tcp-syn",
                                            "title":  "Capa de transporte: segmento TCP SYN",
                                            "description":  "El cliente abre la conexión TCP enviando un segmento SYN con un número de secuencia inicial.",
                                            "activeLayer":  "Transporte",
                                            "layers":  [
                                                           {
                                                               "name":  "Aplicación",
                                                               "protocol":  "HTTP",
                                                               "info":  "Datos listos para encapsular"
                                                           },
                                                           {
                                                               "name":  "Transporte",
                                                               "protocol":  "TCP",
                                                               "info":  "Segmento SYN SEQ=1000",
                                                               "active":  true
                                                           },
                                                           {
                                                               "name":  "Red",
                                                               "protocol":  "IP",
                                                               "info":  "Cabecera IP se añadirá a continuación"
                                                           },
                                                           {
                                                               "name":  "Enlace",
                                                               "protocol":  "Ethernet",
                                                               "info":  "Frame pendiente"
                                                           },
                                                           {
                                                               "name":  "Física",
                                                               "protocol":  "Medio",
                                                               "info":  "Sin señal"
                                                           }
                                                       ],
                                            "packet":  {
                                                           "direction":  "Cliente → Servidor",
                                                           "fields":  [
                                                                          {
                                                                              "label":  "Protocolo capa 4",
                                                                              "value":  "TCP"
                                                                          },
                                                                          {
                                                                              "label":  "Flags",
                                                                              "value":  "SYN=1, ACK=0"
                                                                          },
                                                                          {
                                                                              "label":  "Núm. de secuencia",
                                                                              "value":  "1000"
                                                                          },
                                                                          {
                                                                              "label":  "Puerto de origen",
                                                                              "value":  "49512"
                                                                          },
                                                                          {
                                                                              "label":  "Puerto destino",
                                                                              "value":  "80 (HTTP)"
                                                                          }
                                                                      ]
                                                       },
                                            "events":  [
                                                           "TCP reserva buffers de envío y recepción.",
                                                           "El segmento SYN viaja sin payload de aplicación."
                                                       ]
                                        },
                                        {
                                            "id":  "ip-routing",
                                            "title":  "Capa de red: encapsulado IP y envío",
                                            "description":  "El segmento SYN se encapsula en un paquete IP y se envía al router de salida.",
                                            "activeLayer":  "Red",
                                            "layers":  [
                                                           {
                                                               "name":  "Aplicación",
                                                               "protocol":  "HTTP",
                                                               "info":  "Sin datos en este SYN"
                                                           },
                                                           {
                                                               "name":  "Transporte",
                                                               "protocol":  "TCP",
                                                               "info":  "Segmento SYN listo"
                                                           },
                                                           {
                                                               "name":  "Red",
                                                               "protocol":  "IPv4",
                                                               "info":  "Cabecera IP con IP destino 203.0.113.20",
                                                               "active":  true
                                                           },
                                                           {
                                                               "name":  "Enlace",
                                                               "protocol":  "Ethernet",
                                                               "info":  "Frame con MAC destino del router"
                                                           },
                                                           {
                                                               "name":  "Física",
                                                               "protocol":  "Cobre",
                                                               "info":  "Señales eléctricas"
                                                           }
                                                       ],
                                            "packet":  {
                                                           "direction":  "Cliente → Router",
                                                           "fields":  [
                                                                          {
                                                                              "label":  "IP origen",
                                                                              "value":  "192.0.2.10"
                                                                          },
                                                                          {
                                                                              "label":  "IP destino",
                                                                              "value":  "203.0.113.20"
                                                                          },
                                                                          {
                                                                              "label":  "TTL",
                                                                              "value":  "64"
                                                                          },
                                                                          {
                                                                              "label":  "Tipo de servicio",
                                                                              "value":  "0x00"
                                                                          }
                                                                      ]
                                                       },
                                            "events":  [
                                                           "La tabla de enrutamiento indica que el siguiente salto es el router local.",
                                                           "Se calcula el checksum del encabezado IP.",
                                                           "La capa de enlace busca la dirección MAC del gateway mediante ARP caché."
                                                       ]
                                        },
                                        {
                                            "id":  "http-send",
                                            "title":  "Aplicación: envío de datos tras completar el handshake",
                                            "description":  "Con la conexión establecida, el cliente envía el HTTP GET encapsulado en un segmento TCP con payload.",
                                            "activeLayer":  "Transporte",
                                            "layers":  [
                                                           {
                                                               "name":  "Aplicación",
                                                               "protocol":  "HTTP",
                                                               "info":  "GET /index.html (512 bytes)"
                                                           },
                                                           {
                                                               "name":  "Transporte",
                                                               "protocol":  "TCP",
                                                               "info":  "Segmento PSH, ACK con datos",
                                                               "active":  true
                                                           },
                                                           {
                                                               "name":  "Red",
                                                               "protocol":  "IPv4",
                                                               "info":  "Paquete IP con DF=1"
                                                           },
                                                           {
                                                               "name":  "Enlace",
                                                               "protocol":  "Ethernet",
                                                               "info":  "Frame enviado al router"
                                                           },
                                                           {
                                                               "name":  "Física",
                                                               "protocol":  "Fibra",
                                                               "info":  "Ondas de luz moduladas"
                                                           }
                                                       ],
                                            "packet":  {
                                                           "direction":  "Cliente → Servidor",
                                                           "fields":  [
                                                                          {
                                                                              "label":  "Flags",
                                                                              "value":  "PSH=1, ACK=1"
                                                                          },
                                                                          {
                                                                              "label":  "Núm. de secuencia",
                                                                              "value":  "1001"
                                                                          },
                                                                          {
                                                                              "label":  "Núm. de ACK",
                                                                              "value":  "3501"
                                                                          },
                                                                          {
                                                                              "label":  "Longitud payload",
                                                                              "value":  "512 bytes"
                                                                          }
                                                                      ]
                                                       },
                                            "events":  [
                                                           "El payload HTTP se divide en segmentos si supera la MSS.",
                                                           "La capa TCP añade control de flujo con ventana = 65535.",
                                                           "La capa IP fragmentaría si fuese necesario (DF evita fragmentación)."
                                                       ]
                                        },
                                        {
                                            "id":  "out-of-order",
                                            "title":  "Transporte: llegada fuera de orden",
                                            "description":  "Dos segmentos con datos llegan fuera de orden debido a rutas distintas. La capa de transporte debe reordenarlos antes de pasarlos a la aplicación.",
                                            "activeLayer":  "Transporte",
                                            "layers":  [
                                                           {
                                                               "name":  "Aplicación",
                                                               "protocol":  "HTTP",
                                                               "info":  "A la espera de datos en orden"
                                                           },
                                                           {
                                                               "name":  "Transporte",
                                                               "protocol":  "TCP",
                                                               "info":  "Buffer de reordenamiento activo",
                                                               "active":  true
                                                           },
                                                           {
                                                               "name":  "Red",
                                                               "protocol":  "IPv4",
                                                               "info":  "Paquetes recibidos de diferentes routers"
                                                           },
                                                           {
                                                               "name":  "Enlace",
                                                               "protocol":  "Ethernet",
                                                               "info":  "Frames procesados por la NIC"
                                                           },
                                                           {
                                                               "name":  "Física",
                                                               "protocol":  "Medio",
                                                               "info":  "Señales recibidas"
                                                           }
                                                       ],
                                            "packet":  {
                                                           "direction":  "Servidor (buffer)",
                                                           "fields":  [
                                                                          {
                                                                              "label":  "Segmentos",
                                                                              "value":  "#1 seq=1500, #2 seq=1000"
                                                                          },
                                                                          {
                                                                              "label":  "Ventana",
                                                                              "value":  "16384"
                                                                          },
                                                                          {
                                                                              "label":  "ACK pendiente",
                                                                              "value":  "1000"
                                                                          }
                                                                      ]
                                                       },
                                            "events":  [
                                                           "El segmento con secuencia 1500 llega antes que el 1000.",
                                                           "TCP almacena temporalmente los datos fuera de orden.",
                                                           "Se espera retransmisión o llegada del segmento faltante."
                                                       ],
                                            "challenge":  {
                                                              "type":  "reorder",
                                                              "title":  "Reordena los segmentos",
                                                              "prompt":  "Haz clic en \"Ordenar por número de secuencia\" para simular cómo TCP reconstruye el flujo antes de entregarlo a la aplicación.",
                                                              "segments":  [
                                                                               {
                                                                                   "id":  "B",
                                                                                   "seq":  1500,
                                                                                   "bytes":  "1500-1999",
                                                                                   "status":  "Recibido"
                                                                               },
                                                                               {
                                                                                   "id":  "A",
                                                                                   "seq":  1000,
                                                                                   "bytes":  "1000-1499",
                                                                                   "status":  "Retrasado"
                                                                               },
                                                                               {
                                                                                   "id":  "C",
                                                                                   "seq":  2000,
                                                                                   "bytes":  "2000-2499",
                                                                                   "status":  "En tránsito"
                                                                               }
                                                                           ]
                                                          }
                                        },
                                        {
                                            "id":  "delivery",
                                            "title":  "Entrega ordenada y ACK",
                                            "description":  "Una vez recibidos todos los segmentos, TCP reordena los datos, los pasa a la aplicación y envía un ACK acumulativo.",
                                            "activeLayer":  "Aplicación",
                                            "layers":  [
                                                           {
                                                               "name":  "Aplicación",
                                                               "protocol":  "HTTP",
                                                               "info":  "Mensaje GET reconstruido",
                                                               "active":  true
                                                           },
                                                           {
                                                               "name":  "Transporte",
                                                               "protocol":  "TCP",
                                                               "info":  "ACK acumulativo ACK=2500"
                                                           },
                                                           {
                                                               "name":  "Red",
                                                               "protocol":  "IPv4",
                                                               "info":  "Paquete IP con ACK de respuesta"
                                                           },
                                                           {
                                                               "name":  "Enlace",
                                                               "protocol":  "Ethernet",
                                                               "info":  "Frame enviado de vuelta al cliente"
                                                           },
                                                           {
                                                               "name":  "Física",
                                                               "protocol":  "Medio",
                                                               "info":  "Señal saliente"
                                                           }
                                                       ],
                                            "packet":  {
                                                           "direction":  "Servidor → Cliente",
                                                           "fields":  [
                                                                          {
                                                                              "label":  "ACK",
                                                                              "value":  "2500"
                                                                          },
                                                                          {
                                                                              "label":  "Ventana",
                                                                              "value":  "196608"
                                                                          },
                                                                          {
                                                                              "label":  "Payload",
                                                                              "value":  "(vacío, solo ACK)"
                                                                          }
                                                                      ]
                                                       },
                                            "events":  [
                                                           "TCP entrega los datos en orden a la aplicación.",
                                                           "Se envía un ACK con el siguiente número de secuencia esperado.",
                                                           "La aplicación ya puede procesar la solicitud y preparar la respuesta HTTP."
                                                       ]
                                        }
                                    ],
                          "glossary":  [
                                           {
                                               "term":  "HTTP",
                                               "definition":  "Protocolo de aplicación basado en peticiones/respuestas, definido en RFC 7231."
                                           },
                                           {
                                               "term":  "Handshake TCP",
                                               "definition":  "Proceso de tres pasos (SYN, SYN/ACK, ACK) para establecer una conexión fiable."
                                           },
                                           {
                                               "term":  "MSS",
                                               "definition":  "Máximo tamaño de segmento TCP que puede enviar un host sin fragmentación."
                                           }
                                       ],
                          "references":  [
                                             {
                                                 "title":  "RFC 7231 - Hypertext Transfer Protocol (HTTP/1.1): Semantics and Content",
                                                 "url":  "https://www.rfc-editor.org/rfc/rfc7231"
                                             },
                                             {
                                                 "title":  "RFC 793 - Transmission Control Protocol",
                                                 "url":  "https://www.rfc-editor.org/rfc/rfc793"
                                             },
                                             {
                                                 "title":  "RFC 791 - Internet Protocol",
                                                 "url":  "https://www.rfc-editor.org/rfc/rfc791"
                                             }
                                         ]
                      },
                      {
                          "id":  "udp-stream",
                          "title":  "Streaming UDP con jitter",
                          "summary":  "Envía audio por UDP, mostrando cómo la capa de aplicación usa buffers para mitigar la variación de llegada.",
                          "steps":  [
                                        {
                                            "id":  "app-audio",
                                            "title":  "Aplicación: frames de audio",
                                            "description":  "La app de audio empaqueta 20 ms de audio PCM en datagramas listos para enviar.",
                                            "activeLayer":  "Aplicación",
                                            "layers":  [
                                                           {
                                                               "name":  "Aplicación",
                                                               "protocol":  "RTP",
                                                               "info":  "Frame #120 timestamp 3600",
                                                               "active":  true
                                                           },
                                                           {
                                                               "name":  "Transporte",
                                                               "protocol":  "UDP",
                                                               "info":  "Encabezado UDP vacío"
                                                           },
                                                           {
                                                               "name":  "Red",
                                                               "protocol":  "IP",
                                                               "info":  "TTL predefinido 64"
                                                           },
                                                           {
                                                               "name":  "Enlace",
                                                               "protocol":  "Ethernet",
                                                               "info":  "A la espera de encapsulado"
                                                           },
                                                           {
                                                               "name":  "Física",
                                                               "protocol":  "Fibra",
                                                               "info":  "Sin señal"
                                                           }
                                                       ],
                                            "packet":  {
                                                           "direction":  "Productor → Red",
                                                           "fields":  [
                                                                          {
                                                                              "label":  "Payload",
                                                                              "value":  "Audio PCM 160 bytes"
                                                                          },
                                                                          {
                                                                              "label":  "Timestamp",
                                                                              "value":  "3600"
                                                                          }
                                                                      ]
                                                       },
                                            "events":  [
                                                           "La aplicación marca cada frame con timestamp RTP.",
                                                           "Se selecciona UDP por baja latencia y tolerancia a pérdidas."
                                                       ]
                                        },
                                        {
                                            "id":  "udp-send",
                                            "title":  "Transporte: datagrama UDP",
                                            "description":  "UDP añade solo 8 bytes de cabecera sin handshake ni control de congestión.",
                                            "activeLayer":  "Transporte",
                                            "layers":  [
                                                           {
                                                               "name":  "Aplicación",
                                                               "protocol":  "RTP",
                                                               "info":  "Frame con timestamp 3600"
                                                           },
                                                           {
                                                               "name":  "Transporte",
                                                               "protocol":  "UDP",
                                                               "info":  "Puerto src 5004 dst 5004",
                                                               "active":  true
                                                           },
                                                           {
                                                               "name":  "Red",
                                                               "protocol":  "IPv4",
                                                               "info":  "Checksum pendiente"
                                                           },
                                                           {
                                                               "name":  "Enlace",
                                                               "protocol":  "Ethernet",
                                                               "info":  "MAC destino 00:11:22:33:44:55"
                                                           },
                                                           {
                                                               "name":  "Física",
                                                               "protocol":  "Medio",
                                                               "info":  "Señales moduladas"
                                                           }
                                                       ],
                                            "packet":  {
                                                           "direction":  "Emisor → Receptor",
                                                           "fields":  [
                                                                          {
                                                                              "label":  "Longitud",
                                                                              "value":  "168 bytes"
                                                                          },
                                                                          {
                                                                              "label":  "Checksum UDP",
                                                                              "value":  "0x8ef0"
                                                                          }
                                                                      ]
                                                       },
                                            "events":  [
                                                           "UDP no garantiza entrega ni orden.",
                                                           "Se delega el control de jitter a la aplicación."
                                                       ]
                                        },
                                        {
                                            "id":  "network-jitter",
                                            "title":  "Red: variación de retardo",
                                            "description":  "Los routers introducen jitter; algunos datagramas se retrasan más que otros.",
                                            "activeLayer":  "Red",
                                            "layers":  [
                                                           {
                                                               "name":  "Aplicación",
                                                               "protocol":  "RTP",
                                                               "info":  "Frames #120-123"
                                                           },
                                                           {
                                                               "name":  "Transporte",
                                                               "protocol":  "UDP",
                                                               "info":  "Cola de envío"
                                                           },
                                                           {
                                                               "name":  "Red",
                                                               "protocol":  "IPv4",
                                                               "info":  "TTL decrece en cada salto",
                                                               "active":  true
                                                           },
                                                           {
                                                               "name":  "Enlace",
                                                               "protocol":  "Ethernet",
                                                               "info":  "Frames atravesando switches"
                                                           },
                                                           {
                                                               "name":  "Física",
                                                               "protocol":  "Fibra",
                                                               "info":  "Luz con retardo variable"
                                                           }
                                                       ],
                                            "packet":  {
                                                           "direction":  "Red",
                                                           "fields":  [
                                                                          {
                                                                              "label":  "Variación",
                                                                              "value":  "±12 ms"
                                                                          },
                                                                          {
                                                                              "label":  "Datagramas",
                                                                              "value":  "#120, #121, #122"
                                                                          }
                                                                      ]
                                                       },
                                            "events":  [
                                                           "Los routers priorizan tráfico TCP, UDP espera en cola.",
                                                           "El timestamp RTP permite reordenar en el receptor."
                                                       ]
                                        },
                                        {
                                            "id":  "app-buffer",
                                            "title":  "Aplicación: jitter buffer",
                                            "description":  "El reproductor mantiene 60 ms de búfer para alinear los datagramas antes de reproducirlos.",
                                            "activeLayer":  "Aplicación",
                                            "layers":  [
                                                           {
                                                               "name":  "Aplicación",
                                                               "protocol":  "RTP",
                                                               "info":  "Buffer 3 frames",
                                                               "active":  true
                                                           },
                                                           {
                                                               "name":  "Transporte",
                                                               "protocol":  "UDP",
                                                               "info":  "Datagramas #120-#122"
                                                           },
                                                           {
                                                               "name":  "Red",
                                                               "protocol":  "IPv4",
                                                               "info":  "Llegada fuera de orden"
                                                           },
                                                           {
                                                               "name":  "Enlace",
                                                               "protocol":  "Ethernet",
                                                               "info":  "Tramas entregadas"
                                                           },
                                                           {
                                                               "name":  "Física",
                                                               "protocol":  "Medio",
                                                               "info":  "Datos recibidos"
                                                           }
                                                       ],
                                            "packet":  {
                                                           "direction":  "Receptor",
                                                           "fields":  [
                                                                          {
                                                                              "label":  "Frames en buffer",
                                                                              "value":  "#120, #121, #119"
                                                                          },
                                                                          {
                                                                              "label":  "Playback",
                                                                              "value":  "Compensado"
                                                                          }
                                                                      ]
                                                       },
                                            "events":  [
                                                           "El buffer descarta frames demasiado retrasados.",
                                                           "Se entrega audio continuo al usuario."
                                                       ],
                                            "challenge":  {
                                                              "type":  "reorder",
                                                              "title":  "Simula el jitter buffer",
                                                              "prompt":  "Ordena los frames de menor a mayor timestamp para evitar saltos en el audio.",
                                                              "segments":  [
                                                                               {
                                                                                   "id":  "120",
                                                                                   "seq":  3600,
                                                                                   "bytes":  "Frame 120",
                                                                                   "status":  "En buffer"
                                                                               },
                                                                               {
                                                                                   "id":  "119",
                                                                                   "seq":  3570,
                                                                                   "bytes":  "Frame 119",
                                                                                   "status":  "Llegó tarde"
                                                                               },
                                                                               {
                                                                                   "id":  "121",
                                                                                   "seq":  3630,
                                                                                   "bytes":  "Frame 121",
                                                                                   "status":  "En buffer"
                                                                               }
                                                                           ]
                                                          }
                                        }
                                    ],
                          "glossary":  [
                                           {
                                               "term":  "UDP",
                                               "definition":  "Protocolo ligero sin control de congestión ni reordenamiento, descrito en RFC 768."
                                           },
                                           {
                                               "term":  "RTP",
                                               "definition":  "Protocolo de transporte en tiempo real que añade timestamps y numeración de paquetes."
                                           },
                                           {
                                               "term":  "Jitter buffer",
                                               "definition":  "Búfer en la aplicación que absorbe variaciones de retardo para ofrecer reproducción continua."
                                           }
                                       ],
                          "references":  [
                                             {
                                                 "title":  "RFC 768 - User Datagram Protocol",
                                                 "url":  "https://www.rfc-editor.org/rfc/rfc768"
                                             },
                                             {
                                                 "title":  "RFC 3550 - RTP: A Transport Protocol for Real-Time Applications",
                                                 "url":  "https://www.rfc-editor.org/rfc/rfc3550"
                                             }
                                         ]
                      },
                      {
                          "id":  "arp-icmp",
                          "title":  "Descubrimiento ARP y eco ICMP",
                          "summary":  "Resolve la dirección MAC mediante ARP antes de enviar un ping ICMP a un host local.",
                          "steps":  [
                                        {
                                            "id":  "arp-request",
                                            "title":  "Enlace: solicitud ARP",
                                            "description":  "Antes de hacer ping, el host necesita conocer la MAC del destino en la misma red.",
                                            "activeLayer":  "Enlace",
                                            "layers":  [
                                                           {
                                                               "name":  "Aplicación",
                                                               "protocol":  "Utilidad ping",
                                                               "info":  "Esperando respuesta"
                                                           },
                                                           {
                                                               "name":  "Transporte",
                                                               "protocol":  "ICMP",
                                                               "info":  "Pendiente de envío"
                                                           },
                                                           {
                                                               "name":  "Red",
                                                               "protocol":  "IPv4",
                                                               "info":  "IP destino 192.168.1.50"
                                                           },
                                                           {
                                                               "name":  "Enlace",
                                                               "protocol":  "Ethernet",
                                                               "info":  "Broadcast FF:FF:FF:FF:FF:FF",
                                                               "active":  true
                                                           },
                                                           {
                                                               "name":  "Física",
                                                               "protocol":  "Cobre",
                                                               "info":  "Trama broadcast"
                                                           }
                                                       ],
                                            "packet":  {
                                                           "direction":  "Host → LAN",
                                                           "fields":  [
                                                                          {
                                                                              "label":  "Operación",
                                                                              "value":  "ARP Request"
                                                                          },
                                                                          {
                                                                              "label":  "IP objetivo",
                                                                              "value":  "192.168.1.50"
                                                                          }
                                                                      ]
                                                       },
                                            "events":  [
                                                           "El host construye una trama Ethernet con MAC destino de broadcast.",
                                                           "Se envía el mensaje ARP Who has 192.168.1.50?"
                                                       ]
                                        },
                                        {
                                            "id":  "arp-reply",
                                            "title":  "Enlace: respuesta ARP",
                                            "description":  "El host destino responde con su dirección MAC, que se almacena en caché.",
                                            "activeLayer":  "Enlace",
                                            "layers":  [
                                                           {
                                                               "name":  "Aplicación",
                                                               "protocol":  "Utilidad ping",
                                                               "info":  "Listo para enviar ICMP"
                                                           },
                                                           {
                                                               "name":  "Transporte",
                                                               "protocol":  "ICMP",
                                                               "info":  "Echo request armado"
                                                           },
                                                           {
                                                               "name":  "Red",
                                                               "protocol":  "IPv4",
                                                               "info":  "Sin fragmentación"
                                                           },
                                                           {
                                                               "name":  "Enlace",
                                                               "protocol":  "Ethernet",
                                                               "info":  "Respuesta con MAC 00:aa:bb:cc:dd:ee",
                                                               "active":  true
                                                           },
                                                           {
                                                               "name":  "Física",
                                                               "protocol":  "Cobre",
                                                               "info":  "Trama unicast"
                                                           }
                                                       ],
                                            "packet":  {
                                                           "direction":  "Host destino → Host origen",
                                                           "fields":  [
                                                                          {
                                                                              "label":  "Operación",
                                                                              "value":  "ARP Reply"
                                                                          },
                                                                          {
                                                                              "label":  "MAC",
                                                                              "value":  "00:aa:bb:cc:dd:ee"
                                                                          }
                                                                      ]
                                                       },
                                            "events":  [
                                                           "El host origen actualiza su caché ARP con la MAC recibida.",
                                                           "La trama ARP no pasa a la capa de red: se consume en la NIC.",
                                                           "Ya se puede enviar el paquete IPv4 sin necesidad de broadcast."
                                                       ]
                                        },
                                        {
                                            "id":  "icmp-echo",
                                            "title":  "Red: paquete ICMP Echo",
                                            "description":  "Se encapsula el mensaje ICMP Echo Request y se envía directamente al host destino.",
                                            "activeLayer":  "Red",
                                            "layers":  [
                                                           {
                                                               "name":  "Aplicación",
                                                               "protocol":  "Utilidad ping",
                                                               "info":  "Secuencia #41"
                                                           },
                                                           {
                                                               "name":  "Transporte",
                                                               "protocol":  "ICMP",
                                                               "info":  "Type 8 Code 0"
                                                           },
                                                           {
                                                               "name":  "Red",
                                                               "protocol":  "IPv4",
                                                               "info":  "TTL 64 checksum calculado",
                                                               "active":  true
                                                           },
                                                           {
                                                               "name":  "Enlace",
                                                               "protocol":  "Ethernet",
                                                               "info":  "MAC destino 00:aa:bb:cc:dd:ee"
                                                           },
                                                           {
                                                               "name":  "Física",
                                                               "protocol":  "Cobre",
                                                               "info":  "Señal eléctrica"
                                                           }
                                                       ],
                                            "packet":  {
                                                           "direction":  "Host origen → Host destino",
                                                           "fields":  [
                                                                          {
                                                                              "label":  "Identificador",
                                                                              "value":  "0x1337"
                                                                          },
                                                                          {
                                                                              "label":  "Secuencia",
                                                                              "value":  "41"
                                                                          }
                                                                      ]
                                                       },
                                            "events":  [
                                                           "El paquete IP usa la MAC recibida por ARP.",
                                                           "No se requiere NAT al estar en la misma subred."
                                                       ]
                                        },
                                        {
                                            "id":  "icmp-reply",
                                            "title":  "Aplicación: recibe Echo Reply",
                                            "description":  "El host destino responde con un Echo Reply; la aplicación calcula el RTT.",
                                            "activeLayer":  "Aplicación",
                                            "layers":  [
                                                           {
                                                               "name":  "Aplicación",
                                                               "protocol":  "Utilidad ping",
                                                               "info":  "RTT 1.2 ms",
                                                               "active":  true
                                                           },
                                                           {
                                                               "name":  "Transporte",
                                                               "protocol":  "ICMP",
                                                               "info":  "Type 0 Code 0"
                                                           },
                                                           {
                                                               "name":  "Red",
                                                               "protocol":  "IPv4",
                                                               "info":  "TTL 63"
                                                           },
                                                           {
                                                               "name":  "Enlace",
                                                               "protocol":  "Ethernet",
                                                               "info":  "Trama unicast de respuesta"
                                                           },
                                                           {
                                                               "name":  "Física",
                                                               "protocol":  "Cobre",
                                                               "info":  "Señal recibida"
                                                           }
                                                       ],
                                            "packet":  {
                                                           "direction":  "Host destino → Host origen",
                                                           "fields":  [
                                                                          {
                                                                              "label":  "Identificador",
                                                                              "value":  "0x1337"
                                                                          },
                                                                          {
                                                                              "label":  "Secuencia",
                                                                              "value":  "41"
                                                                          },
                                                                          {
                                                                              "label":  "Datos",
                                                                              "value":  "Payload de 32 bytes"
                                                                          }
                                                                      ]
                                                       },
                                            "events":  [
                                                           "La utilidad ping calcula el RTT usando la marca de tiempo almacenada.",
                                                           "La entrada ARP seguirá en caché unos minutos.",
                                                           "Se actualiza el resumen estadístico del ping."
                                                       ]
                                        }
                                    ],
                          "glossary":  [
                                           {
                                               "term":  "ARP",
                                               "definition":  "Protocolo que resuelve direcciones IP a direcciones MAC dentro de una red local."
                                           },
                                           {
                                               "term":  "ICMP",
                                               "definition":  "Protocolo de control usado para diagnósticos y mensajes de error en IP."
                                           },
                                           {
                                               "term":  "TTL",
                                               "definition":  "Campo de IP que limita el número de saltos que puede recorrer un paquete."
                                           }
                                       ],
                          "references":  [
                                             {
                                                 "title":  "RFC 826 - An Ethernet Address Resolution Protocol",
                                                 "url":  "https://www.rfc-editor.org/rfc/rfc826"
                                             },
                                             {
                                                 "title":  "RFC 792 - Internet Control Message Protocol",
                                                 "url":  "https://www.rfc-editor.org/rfc/rfc792"
                                             }
                                         ]
                      },
                      {
                          "id":  "nat-gateway",
                          "title":  "Navegación HTTP a través de NAT",
                          "summary":  "Tráfico de un cliente en red privada que sale a Internet mediante un gateway con NAT y pool de puertos.",
                          "steps":  [
                                        {
                                            "id":  "lan-request",
                                            "title":  "Aplicación: solicitud desde la LAN",
                                            "description":  "Un equipo 192.168.10.25 inicia una conexión HTTP hacia 198.51.100.20.",
                                            "activeLayer":  "Aplicación",
                                            "layers":  [
                                                           {
                                                               "name":  "Aplicación",
                                                               "protocol":  "HTTP",
                                                               "info":  "GET /catalog",
                                                               "active":  true
                                                           },
                                                           {
                                                               "name":  "Transporte",
                                                               "protocol":  "TCP",
                                                               "info":  "SYN SEQ=3100"
                                                           },
                                                           {
                                                               "name":  "Red",
                                                               "protocol":  "IPv4",
                                                               "info":  "Src 192.168.10.25"
                                                           },
                                                           {
                                                               "name":  "Enlace",
                                                               "protocol":  "Ethernet",
                                                               "info":  "MAC hacia router"
                                                           },
                                                           {
                                                               "name":  "Física",
                                                               "protocol":  "Par trenzado",
                                                               "info":  "Señal saliente"
                                                           }
                                                       ],
                                            "packet":  {
                                                           "direction":  "Cliente → Router NAT",
                                                           "fields":  [
                                                                          {
                                                                              "label":  "IP origen",
                                                                              "value":  "192.168.10.25"
                                                                          },
                                                                          {
                                                                              "label":  "Puerto origen",
                                                                              "value":  "51234"
                                                                          },
                                                                          {
                                                                              "label":  "IP destino",
                                                                              "value":  "198.51.100.20"
                                                                          },
                                                                          {
                                                                              "label":  "Puerto destino",
                                                                              "value":  "80"
                                                                          }
                                                                      ]
                                                       },
                                            "events":  [
                                                           "El host construye la solicitud HTTP y la encapsula sobre TCP.",
                                                           "La tabla de rutas indica que el siguiente salto es el router NAT."
                                                       ]
                                        },
                                        {
                                            "id":  "nat-translation",
                                            "title":  "Red: traducción NAT",
                                            "description":  "El router aplica PAT, reemplazando IP y puerto origen por los públicos.",
                                            "activeLayer":  "Red",
                                            "layers":  [
                                                           {
                                                               "name":  "Aplicación",
                                                               "protocol":  "HTTP",
                                                               "info":  "Handshake en progreso"
                                                           },
                                                           {
                                                               "name":  "Transporte",
                                                               "protocol":  "TCP",
                                                               "info":  "SYN con checksum recalculado"
                                                           },
                                                           {
                                                               "name":  "Red",
                                                               "protocol":  "IPv4",
                                                               "info":  "Src 203.0.113.5",
                                                               "active":  true
                                                           },
                                                           {
                                                               "name":  "Enlace",
                                                               "protocol":  "Ethernet",
                                                               "info":  "MAC hacia ISP"
                                                           },
                                                           {
                                                               "name":  "Física",
                                                               "protocol":  "Fibra",
                                                               "info":  "Señal óptica"
                                                           }
                                                       ],
                                            "packet":  {
                                                           "direction":  "Router NAT → Internet",
                                                           "fields":  [
                                                                          {
                                                                              "label":  "IP origen",
                                                                              "value":  "203.0.113.5"
                                                                          },
                                                                          {
                                                                              "label":  "Puerto origen",
                                                                              "value":  "40045 (mapeado)"
                                                                          },
                                                                          {
                                                                              "label":  "IP destino",
                                                                              "value":  "198.51.100.20"
                                                                          },
                                                                          {
                                                                              "label":  "Puerto destino",
                                                                              "value":  "80"
                                                                          }
                                                                      ]
                                                       },
                                            "events":  [
                                                           "Se consulta la tabla de traducciones; no existe, así que se crea una nueva entrada.",
                                                           "El router reemplaza IP/puerto origen y recalcula checksum de IP y TCP.",
                                                           "El paquete se envía a través del enlace hacia el ISP."
                                                       ],
                                            "challenge":  {
                                                              "type":  "error-sim",
                                                              "title":  "Inyecta eventos en la traducción NAT",
                                                              "prompt":  "Simula distintos escenarios para observar cómo se actualiza la tabla NAT y los temporizadores.",
                                                              "actions":  [
                                                                              {
                                                                                  "id":  "drop",
                                                                                  "label":  "Perder paquete SYN/ACK",
                                                                                  "result":  "El NAT mantiene la entrada en estado pendiente y espera retransmisión."
                                                                              },
                                                                              {
                                                                                  "id":  "timeout",
                                                                                  "label":  "Agotar temporizador",
                                                                                  "result":  "El mapeo NAT expira tras 30 segundos sin tráfico y se elimina."
                                                                              },
                                                                              {
                                                                                  "id":  "ack",
                                                                                  "label":  "Recibir ACK final",
                                                                                  "result":  "El NAT marca la entrada como establecida y renueva el temporizador."
                                                                              }
                                                                          ],
                                                              "successLabel":  "¡Has observado los efectos principales!"
                                                          }
                                        },
                                        {
                                            "id":  "server-response",
                                            "title":  "Aplicación: respuesta del servidor",
                                            "description":  "El servidor acepta la conexión y responde al SYN con SYN/ACK.",
                                            "activeLayer":  "Transporte",
                                            "layers":  [
                                                           {
                                                               "name":  "Aplicación",
                                                               "protocol":  "HTTP",
                                                               "info":  "Preparando respuesta"
                                                           },
                                                           {
                                                               "name":  "Transporte",
                                                               "protocol":  "TCP",
                                                               "info":  "SYN/ACK SEQ=900 ACK=3101",
                                                               "active":  true
                                                           },
                                                           {
                                                               "name":  "Red",
                                                               "protocol":  "IPv4",
                                                               "info":  "Src 198.51.100.20"
                                                           },
                                                           {
                                                               "name":  "Enlace",
                                                               "protocol":  "Ethernet",
                                                               "info":  "Tránsito por ISP"
                                                           },
                                                           {
                                                               "name":  "Física",
                                                               "protocol":  "Fibra",
                                                               "info":  "Retorno"
                                                           }
                                                       ],
                                            "packet":  {
                                                           "direction":  "Servidor → Router NAT",
                                                           "fields":  [
                                                                          {
                                                                              "label":  "IP destino",
                                                                              "value":  "203.0.113.5"
                                                                          },
                                                                          {
                                                                              "label":  "Puerto destino",
                                                                              "value":  "40045"
                                                                          },
                                                                          {
                                                                              "label":  "Flags",
                                                                              "value":  "SYN=1, ACK=1"
                                                                          }
                                                                      ]
                                                       },
                                            "events":  [
                                                           "El servidor responde al puerto público asignado por el NAT.",
                                                           "El paquete viaja por Internet hasta alcanzar el router NAT."
                                                       ]
                                        },
                                        {
                                            "id":  "nat-reverse",
                                            "title":  "Red: deshacer traducción",
                                            "description":  "El router busca la entrada NAT y redirige la respuesta al cliente original.",
                                            "activeLayer":  "Red",
                                            "layers":  [
                                                           {
                                                               "name":  "Aplicación",
                                                               "protocol":  "HTTP",
                                                               "info":  "Respuesta en tránsito"
                                                           },
                                                           {
                                                               "name":  "Transporte",
                                                               "protocol":  "TCP",
                                                               "info":  "SYN/ACK hacia LAN"
                                                           },
                                                           {
                                                               "name":  "Red",
                                                               "protocol":  "IPv4",
                                                               "info":  "Dst 192.168.10.25",
                                                               "active":  true
                                                           },
                                                           {
                                                               "name":  "Enlace",
                                                               "protocol":  "Ethernet",
                                                               "info":  "MAC hacia cliente"
                                                           },
                                                           {
                                                               "name":  "Física",
                                                               "protocol":  "Par trenzado",
                                                               "info":  "Señal entrante"
                                                           }
                                                       ],
                                            "packet":  {
                                                           "direction":  "Router NAT → Cliente",
                                                           "fields":  [
                                                                          {
                                                                              "label":  "IP origen",
                                                                              "value":  "198.51.100.20"
                                                                          },
                                                                          {
                                                                              "label":  "Puerto origen",
                                                                              "value":  "80"
                                                                          },
                                                                          {
                                                                              "label":  "IP destino",
                                                                              "value":  "192.168.10.25"
                                                                          },
                                                                          {
                                                                              "label":  "Puerto destino",
                                                                              "value":  "51234"
                                                                          }
                                                                      ]
                                                       },
                                            "events":  [
                                                           "La tabla NAT identifica la entrada y restaura IP/puerto destino privados.",
                                                           "Se recalculan checksums antes de reenviar el segmento a la LAN.",
                                                           "El handshake continúa hasta completarse."
                                                       ],
                                            "challenge":  {
                                                              "type":  "reorder",
                                                              "title":  "Relaciona traducciones NAT",
                                                              "prompt":  "Ordena las asociaciones de mayor a menor puerto público para visualizar la tabla NAT actual.",
                                                              "segments":  [
                                                                               {
                                                                                   "id":  "40045",
                                                                                   "seq":  40045,
                                                                                   "bytes":  "192.168.10.25:51234",
                                                                                   "status":  "Entrada activa"
                                                                               },
                                                                               {
                                                                                   "id":  "40012",
                                                                                   "seq":  40012,
                                                                                   "bytes":  "192.168.10.40:49160",
                                                                                   "status":  "Entrada previa"
                                                                               },
                                                                               {
                                                                                   "id":  "40078",
                                                                                   "seq":  40078,
                                                                                   "bytes":  "192.168.10.33:52390",
                                                                                   "status":  "En uso"
                                                                               }
                                                                           ]
                                                          }
                                        }
                                    ],
                          "glossary":  [
                                           {
                                               "term":  "NAT",
                                               "definition":  "Traducción de direcciones de red que permite a múltiples hosts privados compartir IP pública."
                                           },
                                           {
                                               "term":  "PAT",
                                               "definition":  "Traducción de puerto y dirección (NAT sobrecargado) que reutiliza una IP pública con puertos distintos."
                                           },
                                           {
                                               "term":  "Checksum",
                                               "definition":  "Suma de verificación que detecta errores en cabeceras IP y TCP/UDP."
                                           }
                                       ],
                          "references":  [
                                             {
                                                 "title":  "RFC 2663 - IP Network Address Translator (NAT) Terminology and Considerations",
                                                 "url":  "https://www.rfc-editor.org/rfc/rfc2663"
                                             },
                                             {
                                                 "title":  "RFC 3022 - Traditional IP Network Address Translator (Traditional NAT)",
                                                 "url":  "https://www.rfc-editor.org/rfc/rfc3022"
                                             }
                                         ]
                      },
                      {
                          "id":  "dns-recursive",
                          "title":  "Resolución DNS recursiva",
                          "summary":  "Consulta DNS desde un cliente hasta obtener la dirección IP usando caché, servidores raíz y autoridad final.",
                          "steps":  [
                                        {
                                            "id":  "stub-resolver",
                                            "title":  "Aplicación: stub resolver local",
                                            "description":  "El sistema operativo revisa la caché y envía una consulta recursiva al resolvedor de la red.",
                                            "activeLayer":  "Aplicación",
                                            "layers":  [
                                                           {
                                                               "name":  "Aplicación",
                                                               "protocol":  "DNS",
                                                               "info":  "Query A www.ejemplo.net",
                                                               "active":  true
                                                           },
                                                           {
                                                               "name":  "Transporte",
                                                               "protocol":  "UDP",
                                                               "info":  "Puerto origen 56214"
                                                           },
                                                           {
                                                               "name":  "Red",
                                                               "protocol":  "IPv4",
                                                               "info":  "Destino 192.168.0.1"
                                                           },
                                                           {
                                                               "name":  "Enlace",
                                                               "protocol":  "Ethernet",
                                                               "info":  "MAC del router"
                                                           },
                                                           {
                                                               "name":  "Física",
                                                               "protocol":  "Cobre",
                                                               "info":  "Frame unicast"
                                                           }
                                                       ],
                                            "packet":  {
                                                           "direction":  "Cliente → Resolver local",
                                                           "fields":  [
                                                                          {
                                                                              "label":  "ID de transacción",
                                                                              "value":  "0x4c2a"
                                                                          },
                                                                          {
                                                                              "label":  "Flags",
                                                                              "value":  "Recursion Desired"
                                                                          }
                                                                      ]
                                                       },
                                            "events":  [
                                                           "La caché local no tiene la entrada solicitada.",
                                                           "Se envía una consulta recursiva al resolvedor del ISP."
                                                       ]
                                        },
                                        {
                                            "id":  "iterative-lookup",
                                            "title":  "Red: iteración por jerarquía DNS",
                                            "description":  "El resolvedor realiza consultas iterativas a raíz, TLD y servidor autoritativo.",
                                            "activeLayer":  "Red",
                                            "layers":  [
                                                           {
                                                               "name":  "Aplicación",
                                                               "protocol":  "DNS",
                                                               "info":  "Resolviendo www.ejemplo.net"
                                                           },
                                                           {
                                                               "name":  "Transporte",
                                                               "protocol":  "UDP",
                                                               "info":  "Puerto 53"
                                                           },
                                                           {
                                                               "name":  "Red",
                                                               "protocol":  "IPv4",
                                                               "info":  "Saltos múltiples",
                                                               "active":  true
                                                           },
                                                           {
                                                               "name":  "Enlace",
                                                               "protocol":  "Ethernet",
                                                               "info":  "Tráfico hacia Internet"
                                                           },
                                                           {
                                                               "name":  "Física",
                                                               "protocol":  "Fibra",
                                                               "info":  "Señal óptica"
                                                           }
                                                       ],
                                            "packet":  {
                                                           "direction":  "Resolver local → Servidores DNS",
                                                           "fields":  [
                                                                          {
                                                                              "label":  "Consultas",
                                                                              "value":  "Root → .net → ejemplo.net"
                                                                          },
                                                                          {
                                                                              "label":  "Respuestas parciales",
                                                                              "value":  "Delegaciones NS"
                                                                          }
                                                                      ]
                                                       },
                                            "events":  [
                                                           "El resolver pregunta a un servidor raíz, que delega al TLD .net.",
                                                           "El TLD responde con los servidores autoritativos de ejemplo.net.",
                                                           "Se consulta al servidor autoritativo, que devuelve el registro definitivo."
                                                       ]
                                        },
                                        {
                                            "id":  "cache-store",
                                            "title":  "Aplicación: respuesta cacheada",
                                            "description":  "El resolvedor entrega la respuesta al cliente y almacena el resultado con su TTL.",
                                            "activeLayer":  "Aplicación",
                                            "layers":  [
                                                           {
                                                               "name":  "Aplicación",
                                                               "protocol":  "DNS",
                                                               "info":  "Respuesta A 203.0.113.77",
                                                               "active":  true
                                                           },
                                                           {
                                                               "name":  "Transporte",
                                                               "protocol":  "UDP",
                                                               "info":  "Checksum verificado"
                                                           },
                                                           {
                                                               "name":  "Red",
                                                               "protocol":  "IPv4",
                                                               "info":  "Destino 192.168.0.10"
                                                           },
                                                           {
                                                               "name":  "Enlace",
                                                               "protocol":  "Ethernet",
                                                               "info":  "Frame LAN"
                                                           },
                                                           {
                                                               "name":  "Física",
                                                               "protocol":  "Cobre",
                                                               "info":  "Entrega al host"
                                                           }
                                                       ],
                                            "packet":  {
                                                           "direction":  "Resolver local → Cliente",
                                                           "fields":  [
                                                                          {
                                                                              "label":  "Respuesta",
                                                                              "value":  "203.0.113.77"
                                                                          },
                                                                          {
                                                                              "label":  "TTL",
                                                                              "value":  "3600 s"
                                                                          }
                                                                      ]
                                                       },
                                            "events":  [
                                                           "El resolvedor almacena la respuesta en caché con su TTL.",
                                                           "El proceso de navegador recibe la IP para iniciar la conexión HTTP."
                                                       ],
                                            "challenge":  {
                                                              "type":  "reorder",
                                                              "title":  "Ordena la cadena DNS",
                                                              "prompt":  "Ordena los servidores consultados en el orden correcto (del primero al último).",
                                                              "segments":  [
                                                                               {
                                                                                   "id":  "Autoritativo",
                                                                                   "seq":  3,
                                                                                   "bytes":  "ns1.ejemplo.net",
                                                                                   "status":  "Último"
                                                                               },
                                                                               {
                                                                                   "id":  "Raíz",
                                                                                   "seq":  1,
                                                                                   "bytes":  "a.root-servers.net",
                                                                                   "status":  "Inicial"
                                                                               },
                                                                               {
                                                                                   "id":  "TLD",
                                                                                   "seq":  2,
                                                                                   "bytes":  "a.gtld-servers.net",
                                                                                   "status":  "Segundo"
                                                                               }
                                                                           ]
                                                          }
                                        }
                                    ],
                          "glossary":  [
                                           {
                                               "term":  "Resolvedor recursivo",
                                               "definition":  "Servidor que realiza consultas sucesivas hasta obtener la respuesta final para el cliente."
                                           },
                                           {
                                               "term":  "Delegación DNS",
                                               "definition":  "Proceso por el cual un servidor indica qué autoridad tiene la información solicitada."
                                           },
                                           {
                                               "term":  "TTL DNS",
                                               "definition":  "Tiempo de vida que controla cuánto permanece en caché una respuesta DNS."
                                           }
                                       ],
                          "references":  [
                                             {
                                                 "title":  "RFC 1034 - Domain Names: Concepts and Facilities",
                                                 "url":  "https://www.rfc-editor.org/rfc/rfc1034"
                                             },
                                             {
                                                 "title":  "RFC 1035 - Domain Names: Implementation and Specification",
                                                 "url":  "https://www.rfc-editor.org/rfc/rfc1035"
                                             }
                                         ]
                      },
                      {
                          "id":  "ipsec-vpn",
                          "title":  "Túnel site-to-site IPsec",
                          "summary":  "Establece un túnel IPsec entre dos sedes, mostrando intercambio IKE y encapsulación ESP.",
                          "steps":  [
                                        {
                                            "id":  "ike-sa-init",
                                            "title":  "Transporte: negociación IKEv2",
                                            "description":  "Los gateways intercambian propuestas de cifrado y claves DH.",
                                            "activeLayer":  "Transporte",
                                            "layers":  [
                                                           {
                                                               "name":  "Aplicación",
                                                               "protocol":  "IKEv2",
                                                               "info":  "SA INIT",
                                                               "active":  true
                                                           },
                                                           {
                                                               "name":  "Transporte",
                                                               "protocol":  "UDP",
                                                               "info":  "Puerto 500"
                                                           },
                                                           {
                                                               "name":  "Red",
                                                               "protocol":  "IPv4",
                                                               "info":  "GW-A 198.51.100.10"
                                                           },
                                                           {
                                                               "name":  "Enlace",
                                                               "protocol":  "Ethernet",
                                                               "info":  "WAN MPLS"
                                                           },
                                                           {
                                                               "name":  "Física",
                                                               "protocol":  "Fibra",
                                                               "info":  "Canal"
                                                           }
                                                       ],
                                            "packet":  {
                                                           "direction":  "Gateway A → Gateway B",
                                                           "fields":  [
                                                                          {
                                                                              "label":  "Propuestas",
                                                                              "value":  "AES256/SHA256"
                                                                          },
                                                                          {
                                                                              "label":  "DH group",
                                                                              "value":  "14"
                                                                          }
                                                                      ]
                                                       },
                                            "events":  [
                                                           "Se envía mensaje IKE_SA_INIT con propuestas de cifrado y nonce.",
                                                           "El gateway remoto responde aceptando parámetros y completando DH."
                                                       ]
                                        },
                                        {
                                            "id":  "ike-auth",
                                            "title":  "Aplicación: autenticación e instalación de SA",
                                            "description":  "Intercambio IKE_AUTH para verificar identidades y crear SA de túnel.",
                                            "activeLayer":  "Aplicación",
                                            "layers":  [
                                                           {
                                                               "name":  "Aplicación",
                                                               "protocol":  "IKEv2",
                                                               "info":  "IKE_AUTH",
                                                               "active":  true
                                                           },
                                                           {
                                                               "name":  "Transporte",
                                                               "protocol":  "UDP",
                                                               "info":  "Puerto 4500 (NAT-T)"
                                                           },
                                                           {
                                                               "name":  "Red",
                                                               "protocol":  "IPv4",
                                                               "info":  "Detección NAT"
                                                           },
                                                           {
                                                               "name":  "Enlace",
                                                               "protocol":  "Ethernet",
                                                               "info":  "Segmento WAN"
                                                           },
                                                           {
                                                               "name":  "Física",
                                                               "protocol":  "Fibra",
                                                               "info":  "Sin cambios"
                                                           }
                                                       ],
                                            "packet":  {
                                                           "direction":  "Gateway B → Gateway A",
                                                           "fields":  [
                                                                          {
                                                                              "label":  "Identidad",
                                                                              "value":  "CN=SiteB"
                                                                          },
                                                                          {
                                                                              "label":  "Autenticación",
                                                                              "value":  "Certificado + HASH"
                                                                          }
                                                                      ]
                                                       },
                                            "events":  [
                                                           "Los gateways validan credenciales (certificados o PSK).",
                                                           "Se instalan dos Security Associations ESP (entrada/salida)."
                                                       ]
                                        },
                                        {
                                            "id":  "esp-encapsulation",
                                            "title":  "Red: datos encapsulados en ESP",
                                            "description":  "El tráfico entre subredes se encapsula dentro del túnel IPsec.",
                                            "activeLayer":  "Red",
                                            "layers":  [
                                                           {
                                                               "name":  "Aplicación",
                                                               "protocol":  "HTTP",
                                                               "info":  "10.10.1.20 ↔ 10.20.1.15"
                                                           },
                                                           {
                                                               "name":  "Transporte",
                                                               "protocol":  "TCP",
                                                               "info":  "Puerto 443"
                                                           },
                                                           {
                                                               "name":  "Red",
                                                               "protocol":  "ESP",
                                                               "info":  "SPI 0x1a2b3c",
                                                               "active":  true
                                                           },
                                                           {
                                                               "name":  "Enlace",
                                                               "protocol":  "Ethernet",
                                                               "info":  "Encabezado WAN"
                                                           },
                                                           {
                                                               "name":  "Física",
                                                               "protocol":  "Fibra",
                                                               "info":  "Canal cifrado"
                                                           }
                                                       ],
                                            "packet":  {
                                                           "direction":  "Site A → Site B",
                                                           "fields":  [
                                                                          {
                                                                              "label":  "IP exterior",
                                                                              "value":  "198.51.100.10 → 203.0.113.25"
                                                                          },
                                                                          {
                                                                              "label":  "Payload",
                                                                              "value":  "IP interna cifrada"
                                                                          }
                                                                      ]
                                                       },
                                            "events":  [
                                                           "El paquete interno se encapsula dentro de ESP con autenticación.",
                                                           "Se incrementa el contador de secuencia ESP para evitar replays."
                                                       ],
                                            "challenge":  {
                                                              "type":  "reorder",
                                                              "title":  "Sigue las fases IKE",
                                                              "prompt":  "Ordena las fases correctas de establecimiento del túnel IPsec.",
                                                              "segments":  [
                                                                               {
                                                                                   "id":  "Generar SA IKE",
                                                                                   "seq":  1,
                                                                                   "bytes":  "IKE_SA_INIT",
                                                                                   "status":  "Primero"
                                                                               },
                                                                               {
                                                                                   "id":  "Autenticar",
                                                                                   "seq":  2,
                                                                                   "bytes":  "IKE_AUTH",
                                                                                   "status":  "Segundo"
                                                                               },
                                                                               {
                                                                                   "id":  "Proteger datos",
                                                                                   "seq":  3,
                                                                                   "bytes":  "ESP",
                                                                                   "status":  "Tercero"
                                                                               }
                                                                           ]
                                                          }
                                        }
                                    ],
                          "glossary":  [
                                           {
                                               "term":  "IKEv2",
                                               "definition":  "Protocolo de intercambio de claves que negocia y autentica asociaciones de seguridad IPsec."
                                           },
                                           {
                                               "term":  "ESP",
                                               "definition":  "Encapsulating Security Payload, proporciona confidencialidad e integridad a paquetes IP."
                                           },
                                           {
                                               "term":  "Security Association",
                                               "definition":  "Parámetros compartidos (algoritmos, claves, SPI) que definen un canal seguro."
                                           }
                                       ],
                          "references":  [
                                             {
                                                 "title":  "RFC 7296 - Internet Key Exchange Protocol Version 2 (IKEv2)",
                                                 "url":  "https://www.rfc-editor.org/rfc/rfc7296"
                                             },
                                             {
                                                 "title":  "RFC 4303 - IP Encapsulating Security Payload (ESP)",
                                                 "url":  "https://www.rfc-editor.org/rfc/rfc4303"
                                             }
                                         ]
                      },
                      {
                          "id":  "http-media",
                          "title":  "Carga de página con recursos multimedia",
                          "summary":  "El navegador descarga el HTML y después solicita una imagen externa reutilizando la misma conexión TCP.",
                          "steps":  [
                                        {
                                            "id":  "html-request",
                                            "title":  "HTTP: solicitud del documento base",
                                            "description":  "El navegador envía GET /home.html reutilizando la conexión TCP abierta para el host.",
                                            "activeLayer":  "Aplicación",
                                            "layers":  [
                                                           {
                                                               "name":  "Aplicación",
                                                               "protocol":  "HTTP",
                                                               "info":  "GET /home.html HTTP/1.1",
                                                               "active":  true
                                                           },
                                                           {
                                                               "name":  "Transporte",
                                                               "protocol":  "TCP",
                                                               "info":  "PSH, ACK con SEQ=4120"
                                                           },
                                                           {
                                                               "name":  "Red",
                                                               "protocol":  "IPv4",
                                                               "info":  "Destino 93.184.216.34"
                                                           },
                                                           {
                                                               "name":  "Enlace",
                                                               "protocol":  "Ethernet",
                                                               "info":  "MAC del router de salida"
                                                           },
                                                           {
                                                               "name":  "Física",
                                                               "protocol":  "Fibra",
                                                               "info":  "Trama óptica saliente"
                                                           }
                                                       ],
                                            "packet":  {
                                                           "direction":  "Cliente → Servidor",
                                                           "fields":  [
                                                                          {
                                                                              "label":  "Método",
                                                                              "value":  "GET"
                                                                          },
                                                                          {
                                                                              "label":  "Host",
                                                                              "value":  "www.ejemplo.net"
                                                                          },
                                                                          {
                                                                              "label":  "Cabeceras",
                                                                              "value":  "Accept: text/html, Connection: keep-alive"
                                                                          }
                                                                      ]
                                                       },
                                            "events":  [
                                                           "El motor de render detecta que no hay caché válida para /home.html.",
                                                           "Se reutiliza la sesión TCP existente para evitar otro handshake.",
                                                           "El paquete incluye cabeceras que habilitan compresión y persistencia."
                                                       ]
                                        },
                                        {
                                            "id":  "html-response",
                                            "title":  "HTTP: respuesta HTML",
                                            "description":  "El servidor devuelve el documento HTML comprimido con gzip.",
                                            "activeLayer":  "Aplicación",
                                            "layers":  [
                                                           {
                                                               "name":  "Aplicación",
                                                               "protocol":  "HTTP",
                                                               "info":  "200 OK text/html",
                                                               "active":  true
                                                           },
                                                           {
                                                               "name":  "Transporte",
                                                               "protocol":  "TCP",
                                                               "info":  "Segmentos PSH con ACK=4121"
                                                           },
                                                           {
                                                               "name":  "Red",
                                                               "protocol":  "IPv4",
                                                               "info":  "Origen 93.184.216.34"
                                                           },
                                                           {
                                                               "name":  "Enlace",
                                                               "protocol":  "Ethernet",
                                                               "info":  "Frame hacia el cliente"
                                                           },
                                                           {
                                                               "name":  "Física",
                                                               "protocol":  "Fibra",
                                                               "info":  "Luz modulada"
                                                           }
                                                       ],
                                            "packet":  {
                                                           "direction":  "Servidor → Cliente",
                                                           "fields":  [
                                                                          {
                                                                              "label":  "Estado",
                                                                              "value":  "200 OK"
                                                                          },
                                                                          {
                                                                              "label":  "Content-Type",
                                                                              "value":  "text/html; charset=UTF-8"
                                                                          },
                                                                          {
                                                                              "label":  "Content-Encoding",
                                                                              "value":  "gzip"
                                                                          }
                                                                      ]
                                                       },
                                            "events":  [
                                                           "El servidor envía primero la cabecera HTTP y después el cuerpo comprimido.",
                                                           "El navegador empieza a parsear el HTML en streaming.",
                                                           "Se actualiza la caché con el nuevo ETag y fecha de expiración."
                                                       ]
                                        },
                                        {
                                            "id":  "image-request",
                                            "title":  "Descubrimiento de recursos e imagen",
                                            "description":  "Al parsear el HTML se detecta una etiqueta \u003cimg\u003e y se lanza una nueva solicitud GET para la imagen.",
                                            "activeLayer":  "Aplicación",
                                            "layers":  [
                                                           {
                                                               "name":  "Aplicación",
                                                               "protocol":  "HTTP",
                                                               "info":  "GET /assets/logo.png",
                                                               "active":  true
                                                           },
                                                           {
                                                               "name":  "Transporte",
                                                               "protocol":  "TCP",
                                                               "info":  "SEQ=5234, ACK=7050"
                                                           },
                                                           {
                                                               "name":  "Red",
                                                               "protocol":  "IPv4",
                                                               "info":  "Destino 93.184.216.34"
                                                           },
                                                           {
                                                               "name":  "Enlace",
                                                               "protocol":  "Ethernet",
                                                               "info":  "Misma MAC del gateway"
                                                           },
                                                           {
                                                               "name":  "Física",
                                                               "protocol":  "Fibra",
                                                               "info":  "Señal saliente"
                                                           }
                                                       ],
                                            "packet":  {
                                                           "direction":  "Cliente → Servidor",
                                                           "fields":  [
                                                                          {
                                                                              "label":  "Método",
                                                                              "value":  "GET"
                                                                          },
                                                                          {
                                                                              "label":  "Referer",
                                                                              "value":  "https://www.ejemplo.net/home.html"
                                                                          },
                                                                          {
                                                                              "label":  "Accept",
                                                                              "value":  "image/*"
                                                                          }
                                                                      ]
                                                       },
                                            "events":  [
                                                           "El parser añade la solicitud a la cola de descargas de recursos.",
                                                           "Se mantienen cabeceras persistentes y cookies de la sesión.",
                                                           "El pipeline puede lanzar en paralelo otras peticiones (CSS, JS)."
                                                       ]
                                        },
                                        {
                                            "id":  "image-response",
                                            "title":  "Entrega del recurso binario",
                                            "description":  "El servidor responde con la imagen PNG usando transferencias segmentadas.",
                                            "activeLayer":  "Aplicación",
                                            "layers":  [
                                                           {
                                                               "name":  "Aplicación",
                                                               "protocol":  "HTTP",
                                                               "info":  "200 OK image/png",
                                                               "active":  true
                                                           },
                                                           {
                                                               "name":  "Transporte",
                                                               "protocol":  "TCP",
                                                               "info":  "Ventana deslizante para 128 KB"
                                                           },
                                                           {
                                                               "name":  "Red",
                                                               "protocol":  "IPv4",
                                                               "info":  "Origen 93.184.216.34"
                                                           },
                                                           {
                                                               "name":  "Enlace",
                                                               "protocol":  "Ethernet",
                                                               "info":  "Frame hacia la NIC"
                                                           },
                                                           {
                                                               "name":  "Física",
                                                               "protocol":  "Fibra",
                                                               "info":  "Bits recibidos"
                                                           }
                                                       ],
                                            "packet":  {
                                                           "direction":  "Servidor → Cliente",
                                                           "fields":  [
                                                                          {
                                                                              "label":  "Content-Type",
                                                                              "value":  "image/png"
                                                                          },
                                                                          {
                                                                              "label":  "Content-Length",
                                                                              "value":  "87 532 bytes"
                                                                          },
                                                                          {
                                                                              "label":  "Cache-Control",
                                                                              "value":  "max-age=31536000"
                                                                          }
                                                                      ]
                                                       },
                                            "events":  [
                                                           "El recurso se envía en varios segmentos TCP que el navegador reensambla.",
                                                           "La caché guarda el recurso según su política de expiración.",
                                                           "Tras completar la descarga, el motor de render actualiza el DOM y el layout."
                                                       ],
                                            "challenge":  {
                                                              "type":  "reorder",
                                                              "title":  "Ordena la descarga de recursos",
                                                              "prompt":  "Organiza los recursos tal y como el navegador los solicita tras recibir el HTML base.",
                                                              "segments":  [
                                                                               {
                                                                                   "id":  "HTML",
                                                                                   "seq":  1,
                                                                                   "bytes":  "Documento /home.html",
                                                                                   "status":  "Completado"
                                                                               },
                                                                               {
                                                                                   "id":  "CSS",
                                                                                   "seq":  2,
                                                                                   "bytes":  "/assets/site.css",
                                                                                   "status":  "Pendiente"
                                                                               },
                                                                               {
                                                                                   "id":  "IMG",
                                                                                   "seq":  3,
                                                                                   "bytes":  "/assets/logo.png",
                                                                                   "status":  "En curso"
                                                                               },
                                                                               {
                                                                                   "id":  "JS",
                                                                                   "seq":  4,
                                                                                   "bytes":  "/scripts/app.js",
                                                                                   "status":  "Pendiente"
                                                                               }
                                                                           ]
                                                          }
                                        }
                                    ],
                          "glossary":  [
                                           {
                                               "term":  "Keep-Alive",
                                               "definition":  "Cabecera HTTP que permite reutilizar la misma conexión TCP para varias peticiones."
                                           },
                                           {
                                               "term":  "Pipeline de recursos",
                                               "definition":  "Capacidad del navegador para lanzar solicitudes adicionales mientras procesa el HTML base."
                                           },
                                           {
                                               "term":  "Cache-Control",
                                               "definition":  "Cabecera que define cuánto tiempo puede almacenarse un recurso en caché."
                                           }
                                       ],
                          "references":  [
                                             {
                                                 "title":  "RFC 7234 - Hypertext Transfer Protocol (HTTP/1.1): Caching",
                                                 "url":  "https://www.rfc-editor.org/rfc/rfc7234"
                                             },
                                             {
                                                 "title":  "RFC 7233 - HTTP Range Requests",
                                                 "url":  "https://www.rfc-editor.org/rfc/rfc7233"
                                             }
                                         ]
                      },
                      {
                          "id":  "https-tls",
                          "title":  "Establecimiento de sesión HTTPS con TLS 1.3",
                          "summary":  "Cliente y servidor negocian TLS antes de intercambiar la petición HTTP cifrada.",
                          "steps":  [
                                        {
                                            "id":  "client-hello",
                                            "title":  "TLS: ClientHello",
                                            "description":  "El cliente inicia el handshake TLS 1.3 enviando cipher suites y SNI.",
                                            "activeLayer":  "Aplicación",
                                            "layers":  [
                                                           {
                                                               "name":  "Aplicación",
                                                               "protocol":  "TLS 1.3",
                                                               "info":  "ClientHello con SNI",
                                                               "active":  true
                                                           },
                                                           {
                                                               "name":  "Transporte",
                                                               "protocol":  "TCP",
                                                               "info":  "Puerto 443"
                                                           },
                                                           {
                                                               "name":  "Red",
                                                               "protocol":  "IPv6",
                                                               "info":  "Destino 2001:db8::443"
                                                           },
                                                           {
                                                               "name":  "Enlace",
                                                               "protocol":  "Ethernet",
                                                               "info":  "Frame hacia router"
                                                           },
                                                           {
                                                               "name":  "Física",
                                                               "protocol":  "Fibra",
                                                               "info":  "Señal saliente"
                                                           }
                                                       ],
                                            "packet":  {
                                                           "direction":  "Cliente → Servidor",
                                                           "fields":  [
                                                                          {
                                                                              "label":  "Version",
                                                                              "value":  "TLS 1.3"
                                                                          },
                                                                          {
                                                                              "label":  "Cipher Suites",
                                                                              "value":  "TLS_AES_128_GCM_SHA256, TLS_CHACHA20_POLY1305_SHA256"
                                                                          },
                                                                          {
                                                                              "label":  "Extensión SNI",
                                                                              "value":  "secure.ejemplo.net"
                                                                          }
                                                                      ]
                                                       },
                                            "events":  [
                                                           "El cliente ofrece una lista de suites y grupos de curvas elípticas.",
                                                           "Incluye la extensión ALPN proponiendo HTTP/2.",
                                                           "Se añade un nonce aleatorio para la derivación de claves."
                                                       ]
                                        },
                                        {
                                            "id":  "server-hello",
                                            "title":  "TLS: ServerHello y certificado",
                                            "description":  "El servidor selecciona la suite, envía su certificado y parámetros de Diffie-Hellman.",
                                            "activeLayer":  "Aplicación",
                                            "layers":  [
                                                           {
                                                               "name":  "Aplicación",
                                                               "protocol":  "TLS 1.3",
                                                               "info":  "ServerHello + Certificate",
                                                               "active":  true
                                                           },
                                                           {
                                                               "name":  "Transporte",
                                                               "protocol":  "TCP",
                                                               "info":  "ACK del ClientHello"
                                                           },
                                                           {
                                                               "name":  "Red",
                                                               "protocol":  "IPv6",
                                                               "info":  "Origen 2001:db8::443"
                                                           },
                                                           {
                                                               "name":  "Enlace",
                                                               "protocol":  "Ethernet",
                                                               "info":  "Frame hacia cliente"
                                                           },
                                                           {
                                                               "name":  "Física",
                                                               "protocol":  "Fibra",
                                                               "info":  "Señal entrante"
                                                           }
                                                       ],
                                            "packet":  {
                                                           "direction":  "Servidor → Cliente",
                                                           "fields":  [
                                                                          {
                                                                              "label":  "Cipher suite elegida",
                                                                              "value":  "TLS_AES_128_GCM_SHA256"
                                                                          },
                                                                          {
                                                                              "label":  "Certificado",
                                                                              "value":  "CN=secure.ejemplo.net"
                                                                          },
                                                                          {
                                                                              "label":  "Extensión ALPN",
                                                                              "value":  "http/2"
                                                                          }
                                                                      ]
                                                       },
                                            "events":  [
                                                           "El certificado X.509 se firma con la CA intermedia.",
                                                           "Se envía la clave pública para intercambio ECDHE.",
                                                           "El cliente valida el certificado usando su almacén de confianza."
                                                       ]
                                        },
                                        {
                                            "id":  "handshake-finish",
                                            "title":  "TLS: Finished y derivación de claves",
                                            "description":  "Ambas partes generan secretos, verifican integridad y cierran el handshake.",
                                            "activeLayer":  "Aplicación",
                                            "layers":  [
                                                           {
                                                               "name":  "Aplicación",
                                                               "protocol":  "TLS 1.3",
                                                               "info":  "Mensajes Finished",
                                                               "active":  true
                                                           },
                                                           {
                                                               "name":  "Transporte",
                                                               "protocol":  "TCP",
                                                               "info":  "ACK + cifrado habilitado"
                                                           },
                                                           {
                                                               "name":  "Red",
                                                               "protocol":  "IPv6",
                                                               "info":  "TTL reducido a 62"
                                                           },
                                                           {
                                                               "name":  "Enlace",
                                                               "protocol":  "Ethernet",
                                                               "info":  "Frames bidireccionales"
                                                           },
                                                           {
                                                               "name":  "Física",
                                                               "protocol":  "Fibra",
                                                               "info":  "Señal bidireccional"
                                                           }
                                                       ],
                                            "packet":  {
                                                           "direction":  "Duplex",
                                                           "fields":  [
                                                                          {
                                                                              "label":  "Hash de handshake",
                                                                              "value":  "Incluido"
                                                                          },
                                                                          {
                                                                              "label":  "Claves derivadas",
                                                                              "value":  "client_application, server_application"
                                                                          },
                                                                          {
                                                                              "label":  "Reanudación",
                                                                              "value":  "Ticket enviado"
                                                                          }
                                                                      ]
                                                       },
                                            "events":  [
                                                           "Cliente y servidor calculan secretos aplicando HKDF.",
                                                           "Se intercambian tickets de reanudación 0-RTT.",
                                                           "Cualquier mensaje posterior se cifra con las nuevas claves."
                                                       ],
                                            "challenge":  {
                                                              "type":  "quiz",
                                                              "title":  "Comprueba tu comprensión del handshake TLS 1.3",
                                                              "prompt":  "Selecciona la respuesta correcta sobre lo que ocurre tras los mensajes Finished.",
                                                              "question":  "¿Qué garantiza la fase Finished del handshake TLS 1.3?",
                                                              "options":  [
                                                                              {
                                                                                  "id":  "opt1",
                                                                                  "label":  "Que las claves derivadas ofrecen secreto hacia delante perfecto (PFS).",
                                                                                  "correct":  true,
                                                                                  "explanation":  "TLS 1.3 deriva claves efímeras mediante ECDHE y valida el transcript antes de cifrar datos."
                                                                              },
                                                                              {
                                                                                  "id":  "opt2",
                                                                                  "label":  "Que se negocia un nuevo certificado cliente-servidor en cada petición HTTP.",
                                                                                  "correct":  false,
                                                                                  "explanation":  "El certificado se entrega durante el handshake; no se renegocia con cada petición."
                                                                              },
                                                                              {
                                                                                  "id":  "opt3",
                                                                                  "label":  "Que el tráfico HTTP queda en texto claro para depuración.",
                                                                                  "correct":  false,
                                                                                  "explanation":  "Tras Finished todo el tráfico de aplicación viaja cifrado con las claves derivadas."
                                                                              }
                                                                          ],
                                                              "successLabel":  "¡Exacto! PFS protege sesiones previas incluso si se compromete una clave a futuro.",
                                                              "errorLabel":  "Revisa la negociación TLS 1.3 y vuelve a intentarlo."
                                                          }
                                        },
                                        {
                                            "id":  "encrypted-http",
                                            "title":  "HTTP cifrado sobre TLS",
                                            "description":  "La petición GET se envía ahora cifrada dentro de registros TLS.",
                                            "activeLayer":  "Aplicación",
                                            "layers":  [
                                                           {
                                                               "name":  "Aplicación",
                                                               "protocol":  "HTTP/2",
                                                               "info":  "Request stream #1",
                                                               "active":  true
                                                           },
                                                           {
                                                               "name":  "Transporte",
                                                               "protocol":  "TLS 1.3",
                                                               "info":  "Registro Application Data"
                                                           },
                                                           {
                                                               "name":  "Red",
                                                               "protocol":  "IPv6",
                                                               "info":  "Segmentos cifrados"
                                                           },
                                                           {
                                                               "name":  "Enlace",
                                                               "protocol":  "Ethernet",
                                                               "info":  "Frame"
                                                           },
                                                           {
                                                               "name":  "Física",
                                                               "protocol":  "Fibra",
                                                               "info":  "Bits cifrados"
                                                           }
                                                       ],
                                            "packet":  {
                                                           "direction":  "Cliente → Servidor",
                                                           "fields":  [
                                                                          {
                                                                              "label":  "Tipo de registro",
                                                                              "value":  "Application Data"
                                                                          },
                                                                          {
                                                                              "label":  "Longitud",
                                                                              "value":  "1 248 bytes"
                                                                          },
                                                                          {
                                                                              "label":  "HTTP stream",
                                                                              "value":  "Stream ID 1"
                                                                          }
                                                                      ]
                                                       },
                                            "events":  [
                                                           "HTTP/2 comprime cabeceras con HPACK antes de cifrarlas.",
                                                           "El tráfico ahora está protegido contra inspección y modificación.",
                                                           "Las respuestas usarán la misma conexión TLS multiplexada."
                                                       ],
                                            "challenge":  {
                                                              "type":  "reorder",
                                                              "title":  "Fases del handshake TLS",
                                                              "prompt":  "Coloca en orden las fases principales del establecimiento TLS antes de enviar datos de aplicación.",
                                                              "segments":  [
                                                                               {
                                                                                   "id":  "ClientHello",
                                                                                   "seq":  1,
                                                                                   "bytes":  "Oferta de suites",
                                                                                   "status":  "Inicial"
                                                                               },
                                                                               {
                                                                                   "id":  "ServerHello",
                                                                                   "seq":  2,
                                                                                   "bytes":  "Selección y certificado",
                                                                                   "status":  "Segundo"
                                                                               },
                                                                               {
                                                                                   "id":  "Finished",
                                                                                   "seq":  3,
                                                                                   "bytes":  "Hash verificado",
                                                                                   "status":  "Tercero"
                                                                               },
                                                                               {
                                                                                   "id":  "Datos",
                                                                                   "seq":  4,
                                                                                   "bytes":  "HTTP cifrado",
                                                                                   "status":  "Final"
                                                                               }
                                                                           ]
                                                          }
                                        }
                                    ],
                          "glossary":  [
                                           {
                                               "term":  "SNI",
                                               "definition":  "Server Name Indication, extensión TLS que permite alojar varios dominios en la misma IP."
                                           },
                                           {
                                               "term":  "ALPN",
                                               "definition":  "Application-Layer Protocol Negotiation, negocia protocolos como HTTP/2 dentro de TLS."
                                           },
                                           {
                                               "term":  "PFS",
                                               "definition":  "Perfect Forward Secrecy garantiza que la exposición de una clave privada no compromete sesiones previas."
                                           }
                                       ],
                          "references":  [
                                             {
                                                 "title":  "RFC 8446 - The Transport Layer Security (TLS) Protocol Version 1.3",
                                                 "url":  "https://www.rfc-editor.org/rfc/rfc8446"
                                             },
                                             {
                                                 "title":  "RFC 7540 - Hypertext Transfer Protocol Version 2 (HTTP/2)",
                                                 "url":  "https://www.rfc-editor.org/rfc/rfc7540"
                                             }
                                         ]
                      },
                      {
                          "id":  "smtp-delivery",
                          "title":  "Entrega de correo con SMTP e IMAP",
                          "summary":  "Un cliente envía un correo al servidor SMTP y el destinatario lo recupera mediante IMAP.",
                          "steps":  [
                                        {
                                            "id":  "smtp-connect",
                                            "title":  "SMTP: saludo inicial",
                                            "description":  "El cliente se conecta al puerto 587 y envía EHLO para declarar capacidades.",
                                            "activeLayer":  "Aplicación",
                                            "layers":  [
                                                           {
                                                               "name":  "Aplicación",
                                                               "protocol":  "SMTP",
                                                               "info":  "EHLO mail.alumno.edu",
                                                               "active":  true
                                                           },
                                                           {
                                                               "name":  "Transporte",
                                                               "protocol":  "TCP",
                                                               "info":  "Puerto destino 587"
                                                           },
                                                           {
                                                               "name":  "Red",
                                                               "protocol":  "IPv4",
                                                               "info":  "Destino 203.0.113.40"
                                                           },
                                                           {
                                                               "name":  "Enlace",
                                                               "protocol":  "Ethernet",
                                                               "info":  "Frame hacia ISP"
                                                           },
                                                           {
                                                               "name":  "Física",
                                                               "protocol":  "Par trenzado",
                                                               "info":  "Señal eléctrica"
                                                           }
                                                       ],
                                            "packet":  {
                                                           "direction":  "Cliente SMTP → Servidor",
                                                           "fields":  [
                                                                          {
                                                                              "label":  "Comando",
                                                                              "value":  "EHLO mail.alumno.edu"
                                                                          },
                                                                          {
                                                                              "label":  "Extensiones",
                                                                              "value":  "STARTTLS, AUTH PLAIN"
                                                                          }
                                                                      ]
                                                       },
                                            "events":  [
                                                           "El servidor responde con 250 indicando las extensiones soportadas.",
                                                           "Si se requiere seguridad, a continuación se ejecuta STARTTLS.",
                                                           "Tras el saludo queda abierta la sesión SMTP."
                                                       ]
                                        },
                                        {
                                            "id":  "smtp-envelope",
                                            "title":  "SMTP: sobre del mensaje",
                                            "description":  "Se indican origen y destinatarios usando MAIL FROM y RCPT TO.",
                                            "activeLayer":  "Aplicación",
                                            "layers":  [
                                                           {
                                                               "name":  "Aplicación",
                                                               "protocol":  "SMTP",
                                                               "info":  "MAIL FROM / RCPT TO",
                                                               "active":  true
                                                           },
                                                           {
                                                               "name":  "Transporte",
                                                               "protocol":  "TCP",
                                                               "info":  "ACK 250 para cada comando"
                                                           },
                                                           {
                                                               "name":  "Red",
                                                               "protocol":  "IPv4",
                                                               "info":  "Ruta hacia MX remoto"
                                                           },
                                                           {
                                                               "name":  "Enlace",
                                                               "protocol":  "Ethernet",
                                                               "info":  "Frame a través del ISP"
                                                           },
                                                           {
                                                               "name":  "Física",
                                                               "protocol":  "Par trenzado",
                                                               "info":  "Señal"
                                                           }
                                                       ],
                                            "packet":  {
                                                           "direction":  "Cliente SMTP → Servidor",
                                                           "fields":  [
                                                                          {
                                                                              "label":  "MAIL FROM",
                                                                              "value":  "\u003cprofesor@alumno.edu\u003e"
                                                                          },
                                                                          {
                                                                              "label":  "RCPT TO",
                                                                              "value":  "\u003cequipo@centro.edu\u003e"
                                                                          },
                                                                          {
                                                                              "label":  "Respuestas",
                                                                              "value":  "250 OK"
                                                                          }
                                                                      ]
                                                       },
                                            "events":  [
                                                           "El sobre SMTP define quién puede enviar y quién recibirá el correo.",
                                                           "El servidor registra las direcciones antes de aceptar el contenido.",
                                                           "En caso de múltiples destinatarios se envía RCPT TO por cada uno."
                                                       ]
                                        },
                                        {
                                            "id":  "smtp-data",
                                            "title":  "SMTP: contenido del mensaje",
                                            "description":  "Tras el comando DATA se envían cabeceras y cuerpo del correo.",
                                            "activeLayer":  "Aplicación",
                                            "layers":  [
                                                           {
                                                               "name":  "Aplicación",
                                                               "protocol":  "SMTP",
                                                               "info":  "DATA + mensaje MIME",
                                                               "active":  true
                                                           },
                                                           {
                                                               "name":  "Transporte",
                                                               "protocol":  "TCP",
                                                               "info":  "Segmentos PSH"
                                                           },
                                                           {
                                                               "name":  "Red",
                                                               "protocol":  "IPv4",
                                                               "info":  "Rutas hacia servidor remoto"
                                                           },
                                                           {
                                                               "name":  "Enlace",
                                                               "protocol":  "Ethernet",
                                                               "info":  "Frame"
                                                           },
                                                           {
                                                               "name":  "Física",
                                                               "protocol":  "Par trenzado",
                                                               "info":  "Señal"
                                                           }
                                                       ],
                                            "packet":  {
                                                           "direction":  "Cliente SMTP → Servidor",
                                                           "fields":  [
                                                                          {
                                                                              "label":  "Cabeceras",
                                                                              "value":  "From, To, Subject, Date"
                                                                          },
                                                                          {
                                                                              "label":  "Cuerpo",
                                                                              "value":  "Mensaje en texto plano (7bit)"
                                                                          },
                                                                          {
                                                                              "label":  "Cierre",
                                                                              "value":  ". (CRLF . CRLF)"
                                                                          }
                                                                      ]
                                                       },
                                            "events":  [
                                                           "El servidor almacena el mensaje en la cola de entrega.",
                                                           "Si el destino está en otra organización se abre una sesión SMTP adicional (relaying).",
                                                           "Se devuelve respuesta 250 Message accepted for delivery."
                                                       ],
                                            "challenge":  {
                                                              "type":  "reorder",
                                                              "title":  "Ordena las fases del envío SMTP",
                                                              "prompt":  "Organiza los comandos fundamentales para completar un envío SMTP básico.",
                                                              "segments":  [
                                                                               {
                                                                                   "id":  "EHLO",
                                                                                   "seq":  1,
                                                                                   "bytes":  "EHLO dominio",
                                                                                   "status":  "Saludo"
                                                                               },
                                                                               {
                                                                                   "id":  "MAIL",
                                                                                   "seq":  2,
                                                                                   "bytes":  "MAIL FROM",
                                                                                   "status":  "Remitente"
                                                                               },
                                                                               {
                                                                                   "id":  "RCPT",
                                                                                   "seq":  3,
                                                                                   "bytes":  "RCPT TO",
                                                                                   "status":  "Destinatario"
                                                                               },
                                                                               {
                                                                                   "id":  "DATA",
                                                                                   "seq":  4,
                                                                                   "bytes":  "DATA + mensaje",
                                                                                   "status":  "Contenido"
                                                                               },
                                                                               {
                                                                                   "id":  "QUIT",
                                                                                   "seq":  5,
                                                                                   "bytes":  "QUIT",
                                                                                   "status":  "Cierre"
                                                                               }
                                                                           ],
                                                              "successLabel":  "Orden correcto: saludo, remitente, destinatario, contenido y cierre.",
                                                              "errorLabel":  "SMTP exige MAIL FROM y RCPT TO antes de DATA. Inténtalo de nuevo."
                                                          }
                                        },
                                        {
                                            "id":  "imap-fetch",
                                            "title":  "IMAP: recuperación del mensaje",
                                            "description":  "El destinatario se conecta por IMAP4 para descargar el correo recién entregado.",
                                            "activeLayer":  "Aplicación",
                                            "layers":  [
                                                           {
                                                               "name":  "Aplicación",
                                                               "protocol":  "IMAP4",
                                                               "info":  "FETCH 42 BODY[]",
                                                               "active":  true
                                                           },
                                                           {
                                                               "name":  "Transporte",
                                                               "protocol":  "TCP",
                                                               "info":  "Puerto 993 TLS"
                                                           },
                                                           {
                                                               "name":  "Red",
                                                               "protocol":  "IPv4",
                                                               "info":  "Destino 203.0.113.40"
                                                           },
                                                           {
                                                               "name":  "Enlace",
                                                               "protocol":  "Ethernet",
                                                               "info":  "Frame hacia servidor"
                                                           },
                                                           {
                                                               "name":  "Física",
                                                               "protocol":  "Fibra",
                                                               "info":  "Señal"
                                                           }
                                                       ],
                                            "packet":  {
                                                           "direction":  "Cliente IMAP → Servidor",
                                                           "fields":  [
                                                                          {
                                                                              "label":  "Comando",
                                                                              "value":  "A142 FETCH 42 BODY[]"
                                                                          },
                                                                          {
                                                                              "label":  "Autenticación",
                                                                              "value":  "IDLE/LOGIN seguras"
                                                                          }
                                                                      ]
                                                       },
                                            "events":  [
                                                           "IMAP permite sincronizar carpetas y estados de lectura.",
                                                           "El mensaje ya se encuentra almacenado en el buzón INBOX.",
                                                           "El cliente puede descargar adjuntos parciales gracias a IMAP."
                                                       ],
                                            "challenge":  {
                                                              "type":  "quiz",
                                                              "title":  "Consulta rápida de IMAP",
                                                              "prompt":  "Responde para recordar cómo IMAP sincroniza el correo entre dispositivos.",
                                                              "question":  "¿Qué ventaja ofrece IMAP frente a POP3 en entornos multi-dispositivo?",
                                                              "options":  [
                                                                              {
                                                                                  "id":  "imap-opt1",
                                                                                  "label":  "Permite sincronizar carpetas y estados de lectura directamente en el servidor.",
                                                                                  "correct":  true,
                                                                                  "explanation":  "IMAP mantiene el correo en el servidor y sincroniza cambios entre clientes."
                                                                              },
                                                                              {
                                                                                  "id":  "imap-opt2",
                                                                                  "label":  "Descarga y elimina todos los correos del servidor automáticamente.",
                                                                                  "correct":  false,
                                                                                  "explanation":  "Ese comportamiento corresponde a POP3 por defecto."
                                                                              },
                                                                              {
                                                                                  "id":  "imap-opt3",
                                                                                  "label":  "Sólo admite conexiones sin cifrar y puertos inseguros.",
                                                                                  "correct":  false,
                                                                                  "explanation":  "IMAP soporta TLS/SSL en el puerto 993 y STARTTLS en el 143."
                                                                              }
                                                                          ]
                                                          }
                                        }
                                    ],
                          "glossary":  [
                                           {
                                               "term":  "Sobre SMTP",
                                               "definition":  "Conjunto de comandos MAIL FROM y RCPT TO que define remitente y destinatarios."
                                           },
                                           {
                                               "term":  "DATA",
                                               "definition":  "Comando que inicia el envío del contenido del mensaje, finaliza con una línea que contiene solo un punto."
                                           },
                                           {
                                               "term":  "IMAP",
                                               "definition":  "Internet Message Access Protocol, permite consultar correo en el servidor manteniendo sincronía."
                                           }
                                       ],
                          "references":  [
                                             {
                                                 "title":  "RFC 5321 - Simple Mail Transfer Protocol",
                                                 "url":  "https://www.rfc-editor.org/rfc/rfc5321"
                                             },
                                             {
                                                 "title":  "RFC 5322 - Internet Message Format",
                                                 "url":  "https://www.rfc-editor.org/rfc/rfc5322"
                                             },
                                             {
                                                 "title":  "RFC 3501 - Internet Message Access Protocol - Version 4rev1",
                                                 "url":  "https://www.rfc-editor.org/rfc/rfc3501"
                                             }
                                         ]
                      }
                  ]
}



